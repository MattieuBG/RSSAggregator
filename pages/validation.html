<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

        <div class="checkbox">
            <label><input type="checkbox" ng-model="showAll">Montrer tous les masters (y compris ceux validés)</label>
        </div>

        <br/>
    </div>
</div>

<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
        <div class="alert alert-info">
            <input ng-model="owner" type="text" size="30">
            <button type="button" class="btn btn-sm btn-primary" ng-click="getMastersForOwner()" ng-cloak>
                Chercher par BU
            </button>
        </div>
    </div>

    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
        <div class="alert alert-info">
            <input ng-model="specificMasterEventId" type="text" size="30">
            <button type="button" class="btn btn-sm btn-primary" ng-click="getSpecificMasterEvent()" ng-cloak>
                Chercher par ID
            </button>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <ul uib-pagination total-items="bigTotalItems" ng-model="bigCurrentPage" ng-change="pageChanged()"
            max-size="maxSize"
            class="pagination-sm" boundary-links="true" num-pages="numPages" ng-show="showPagination"></ul>

        <table class="table table-striped table-condensed table-responsive" ng-if="data.length > 0">
            <thead>
            <tr>
                <th>Titre</th>
                <th>Type</th>
                <th>Promo</th>
                <th>Biz user</th>
                <th>Catégorie</th>
                <th>Mode horaire</th>
                <th>Quota par défaut</th>
                <th>Lieu</th>
                <th>Date de création</th>
                <th>Occurrences</th>
                <th>-</th>
            </tr>
            </thead>
            <tbody>

            <tr ng-repeat="response in data" ng-class="{ success: response.greenBackground }">
                <td>
                    {{response.master.title}}<br/>
                    <small>{{response.master.id}}</small>
                </td>
                <td>
                    {{response.master.visibilityOrTicketing}}<br/>
                    <span ng-if="response.master.isTransformed">
                        <small>(transformé)</small><br/>
                    </span>
		    <span ng-if="response.master.customTag">
		        <small>{{ response.master.customTag }}</small><br />
		    </span>  
                </td>
                <td>
                    Promo : {{ response.master.hasPromotion ? "oui" : "non" }}<br/>
                    <span ng-if="response.master.hasPromotion && response.master.pricePromotion">
                        Prix : {{ formatPricePromotion(response.master.price, response.master.currency) }}
                    </span>
                    <span ng-if="response.master.hasPromotion && !response.master.pricePromotion">
                        Texte : {{ response.master.promotionText }}
                    </span>
                </td>
                <td>
                    {{response.master.owner}}
                </td>
                <td>
                    {{response.master.category}}
                </td>
                <td>
                    {{response.master.hourMode}}
                </td>
                <td>
                    {{response.master.defaultQuota}}
                </td>
                <td>
                    {{response.master.placeName}}
                </td>
                <td>
                    {{response.master.createdDate}}
                </td>
                <td>
                    {{response.children.length}}
                </td>
                <td>
                    <button type="button" class="btn btn-primary btn-sm"
                            ng-click="openModal(response.master, response.children)">
                        Voir
                    </button>
                    <button type="button" class="btn btn-sm btn-success" ng-if="!response.master.isValidated"
                            ng-click="setValidation(response, true, true)">
                        Valider
                    </button>
                    <button type="button" class="btn btn-sm btn-warning" ng-if="!response.master.isValidated"
                            ng-click="setValidation(response, true, false)">
                        Valider sans email
                    </button>
                    <button type="button" class="btn btn-sm btn-danger" ng-if="response.master.isValidated"
                            ng-click="setValidation(response, false, false)">
                        Invalider
                    </button>
                    <button type="button" class="btn btn-sm btn-warning" ng-click="convertToTicketV1(response)"
                            ng-show="showConvertToTicketV1Button(response)" ng-cloak>
                        Transformer en TICKET V1
                    </button>
                    <button type="button" class="btn btn-sm btn-warning" ng-click="convertToBookable(response)"
                            ng-show="showConvertToBookableV1Button(response)" ng-cloak>
                        Transformer en BOOKABLE V1 sans validation
                    </button>
                    <button type="button" class="btn btn-sm btn-warning"
                            ng-click="convertToBookAndPay(response, true, true)"
                            ng-show="showConvertToBookAndPayButton(response)" ng-cloak>
                        Transformer en BOOKANDPAY (instant + book and pay)
                    </button>
                    <button type="button" class="btn btn-sm btn-warning"
                            ng-click="convertToBookAndPay(response, true, false)"
                            ng-show="showConvertToBookAndPayButton(response)" ng-cloak>
                        Transformer en BOOKANDPAY (instant only)
                    </button>
                    <button type="button" class="btn btn-sm btn-warning"
                            ng-click="convertToBookAndPay(response, false, true)"
                            ng-show="showConvertToBookAndPayButton(response)" ng-cloak>
                        Transformer en BOOKANDPAY (book and pay)
                    </button>
                    <button type="button" class="btn btn-sm btn-danger"
                            ng-click="neutralizeMasterAndEvent(response, false)"
                            ng-if="response.master.visibilityOrTicketing != 'nobooking'" ng-cloak>
                        Neutraliser master seulement
                    </button>
                    <button type="button" class="btn btn-sm btn-danger"
                            ng-click="neutralizeMasterAndEvent(response, true)"
                            ng-if="response.master.visibilityOrTicketing != 'nobooking'" ng-cloak>
                        Neutraliser master + promo
                    </button>
                </td>
            </tr>
            </tbody>
        </table>

        <div class="alert alert-info" ng-if="showAll && (!data || data.length == 0)">
            Aucun master validé.
        </div>

        <div class="alert alert-info" ng-if="!showAll && (!data || data.length == 0)">
            Aucun master en attente de validation.
        </div>

    </div>
</div>

<ul uib-pagination total-items="bigTotalItems" ng-model="bigCurrentPage" ng-change="pageChanged()" max-size="maxSize"
    class="pagination-sm" boundary-links="true" num-pages="numPages" ng-show="showPagination"></ul>

<script type="text/ng-template" id="masterModal.html">
    <div class="modal-body modal-preview">
        <div class='row'>
            <div class="col-sm-12">
                <div style="margin-bottom: 15px;">
                    <img id="previewImage" class="img-responsive" style="margin: 0 auto;" src="{{imageUrl}}"/>
                </div>

                <div class="panel panel-default ts-panel-header">
                    <div class="panel-body">
                        <table class="tableh">
                            <tr style="color: #e94b46">
                                <td colspan="2">
                                    <h5>{{master.title}}</h5>
                                </td>
                            </tr>
                            <tr>
                                <td style="height: 30px; width: 30px;">
                                    <img src="./img/promotion.png" style="width: 20px; margin: 0 auto;">
                                </td>
                                <td class="pdesc capitalise">
                                <span ng-show="master.pricePromotion">
                                    {{master.price.displayedPrice}}{{currencySymbol}} au lieu de {{master.price.initialPrice}}{{currencySymbol}}
                                </span>
                                    <span ng-show="!master.pricePromotion">{{master.promotionText}}</span>
                                </td>
                            </tr>
                            <tr ng-show="hasDate">
                                <td style="height: 30px; width: 30px;">
                                    <img src="./img/clock.png" style="width: 20px; margin: 0 auto;">
                                </td>
                                <td class="pdesc">
                                    Le {{date}} de {{startTime}} à {{endTime}}
                                </td>
                            </tr>
                            <tr>
                                <td style="height: 30px; width: 30px;">
                                    <img src="./img/adress.png" style="width: 20px; margin: 0 auto;">
                                </td>
                                <td class="pdesc">
                                    <b>{{master.placeName}}</b><br/>
                                    {{master.address}}
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="panel panel-default">
                    <div class="panel-body">
                        <h5 class="apdesc">METADONNEES</h5>
                        ID : {{master.id}}<br/>
                        Catégorie : {{master.category}}<br/>
                        Mode horaire : {{master.hourMode}}<br/>
                        <a target="_blank" href="http://event.tootsweet-app.com/{{child.id}}" ng-if="child">Landing
                            page</a>
                    </div>
                </div>

                <div class="panel panel-default">
                    <div class="panel-body">
                        <h5 class="apdesc">A PROPOS</h5>
                        <p style="white-space:pre-wrap;" class="pdesc capitalise">{{master.description}}</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btnt btn-danger btn-primary" style="width: 100%" ng-click="ok()">Retour</button>

        </div>
    </div>
</script>
